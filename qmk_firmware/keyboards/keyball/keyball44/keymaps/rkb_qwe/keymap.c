/*
Copyright 2022 @Yowkees
Copyright 2022 MURAOKA Taro (aka KoRoN, @kaoriya)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 2 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/

#include QMK_KEYBOARD_H

#include "quantum.h"
#include "keymap_japanese.h"

// ======================================================================
// Layer Defines
// ======================================================================
enum _layers {
  _BASE = 0,   // Basic Layer
  _NUM_MOUSE,  // Number and Mouse Layer
  _FN_SIGN,    // Function and Sign Layer
  _RSV1,       // Reseved Layer 1
  _RSV2,       // Reseved Layer 2
  _MACRO,      // Macro Layer
  _KB_CONF,    // Keyboard Configuration Layer
};

// ======================================================================
// Key Defines
// ======================================================================

// Key Overrides
// ----------------------------------------------------------------------
const key_override_t KO_BS_DEL    = ko_make_with_layers(MOD_MASK_SHIFT, KC_BSPC, KC_DEL, ~0);
const key_override_t KO_COMM_LPRN = ko_make_with_layers(MOD_MASK_SHIFT, KC_COMM, JP_LPRN, 1 << _BASE);
const key_override_t KO_DOT_RPRN  = ko_make_with_layers(MOD_MASK_SHIFT, KC_DOT, JP_RPRN, 1 << _BASE);
const key_override_t KO_SLSH_AT   = ko_make_with_layers(MOD_MASK_SHIFT, JP_SLSH, JP_AT, 1 << _BASE);
const key_override_t KO_MINS_UNDS = ko_make_with_layers(MOD_MASK_SHIFT, JP_MINS, JP_UNDS, 1 << _BASE);
const key_override_t KO_SCLN_COLN = ko_make_with_layers(MOD_MASK_SHIFT, JP_SCLN, JP_COLN, 1 << _BASE);
const key_override_t KO_QUOT_WQUO = ko_make_with_layers_and_negmods(0,  JP_2, JP_QUOT , 1 << _BASE, MOD_MASK_SHIFT);
const key_override_t KO_QUES_EXLM = ko_make_with_layers_and_negmods(0,  JP_1, JP_QUES , 1 << _BASE, MOD_MASK_SHIFT);

// This globally defines all key overrides to be used
const key_override_t **key_overrides = (const key_override_t *[]){
  &KO_BS_DEL,
  &KO_COMM_LPRN,
  &KO_DOT_RPRN,
  &KO_SLSH_AT,
  &KO_MINS_UNDS,
  &KO_SCLN_COLN,
  &KO_QUOT_WQUO,
  &KO_QUES_EXLM,
  NULL // Null terminate the array of overrides!
};

// Key Aliases
// ----------------------------------------------------------------------
#define KA_ESC_L  LT(_RSV1, KC_ESC)     // ESC / Hold: Change Layer
#define KA_TAB_L  LT(_RSV2, KC_TAB)     // TAB / Hold: Change Layer
#define KA_EN_L  LT(_FN_SIGN, KC_LNG2)  // 英数 / Hold: Change Layer
#define KA_SPC_CTL LCTL_T(KC_SPC)       // Space / Hold: Ctrl
#define KA_JP_L  LT(_MACRO, KC_LNG1)     // かな / Hold: Macro Layer
#define KA_ENT_L LT(_NUM_MOUSE, KC_ENT) // Enter / Hold: Change Layer
#define KA_PS_L  LT(_KB_CONF, KC_PSCR)  // PrintScreen / Hold: Keboard Config Layer

// ======================================================================
// Keymap
// ======================================================================
// clang-format off
const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {
  [_BASE] = LAYOUT_right_ball(
// +----------+----------+----------+----------+----------+----------+                                              +----------+----------+----------+----------+----------+----------+
    KA_ESC_L  ,KC_Q      ,KC_W      ,KC_E      ,KC_R      ,KC_T      ,                                               KC_Y      ,KC_U      ,KC_I      ,KC_O      ,KC_P      ,JP_SLSH   ,
// +----------+----------+----------+----------+----------+----------+                                              +----------+----------+----------+----------+----------+----------+
    KA_TAB_L  ,KC_A      ,KC_S      ,KC_D      ,KC_F      ,KC_G      ,                                               KC_H      ,KC_J      ,KC_K      ,KC_L      ,JP_2      ,JP_SCLN   ,
// +----------+----------+----------+----------+----------+----------+                                              +----------+----------+----------+----------+----------+----------+
    KC_LSFT   ,KC_Z      ,KC_X      ,KC_C      ,KC_V      ,KC_B      ,                                               KC_N      ,KC_M      ,KC_COMM   ,KC_DOT    ,KC_MINS   ,JP_1      ,
// +----------+----------+----------+----------+------+---+------+---+------+----------+          +----------+------+---+------+----------+----------+----------+----------+----------+
                          KC_LALT   ,KC_LGUI   ,       KA_EN_L   ,KA_SPC_CTL,KA_JP_L   ,           KC_BSPC   ,KA_ENT_L  ,                                        KA_PS_L
//                       +----------+----------+      +----------+----------+----------+          +----------+----------+                                       +----------+
  ),

  [_NUM_MOUSE] = LAYOUT_right_ball(
// +----------+----------+----------+----------+----------+----------+                                              +----------+----------+----------+----------+----------+----------+
    _______   ,JP_EQL    ,KC_KP_7   ,KC_KP_8   ,KC_KP_9   ,KC_KP_MINUS,                                              AML_TO    ,AML_I50   ,AML_D50   ,CPI_I100  ,CPI_D100  ,SSNP_VRT  ,
// +----------+----------+----------+----------+----------+----------+                                              +----------+----------+----------+----------+----------+----------+
    _______   ,KC_KP_PLUS,KC_KP_4   ,KC_KP_5   ,KC_KP_6   ,KC_KP_ASTERISK,                                           KC_PGUP   ,KC_BTN1   ,KC_BTN3   ,KC_BTN2   ,SCRL_MO   ,SSNP_HOR  ,
// +----------+----------+----------+----------+----------+----------+                                              +----------+----------+----------+----------+----------+----------+
    _______   ,KC_KP_0   ,KC_KP_1   ,KC_KP_2   ,KC_KP_3   ,KC_KP_SLASH,                                              KC_PGDN   ,KC_LEFT   ,KC_DOWN   ,KC_UP     ,KC_RGHT   ,SSNP_FRE  ,
// +----------+----------+----------+----------+------+---+------+---+------+----------+          +----------+------+---+------+----------+----------+----------+----------+----------+
                          _______   ,_______   ,       _______   ,_______   ,_______   ,           _______   ,_______   ,                                        _______
//                       +----------+----------+      +----------+----------+----------+          +----------+----------+                                       +----------+
  ),

  [_FN_SIGN] = LAYOUT_right_ball(
// +----------+----------+----------+----------+----------+----------+                                              +----------+----------+----------+----------+----------+----------+
    _______   ,KC_F1     ,KC_F2     ,KC_F3     ,KC_F4     ,JP_LCBR   ,                                               JP_RCBR   ,JP_AMPR   ,JP_ASTR   ,JP_DLR    ,JP_GRV    ,JP_AT     ,
// +----------+----------+----------+----------+----------+----------+                                              +----------+----------+----------+----------+----------+----------+
    _______   ,KC_F5     ,KC_F6     ,KC_F7     ,KC_F8     ,JP_LBRC   ,                                               JP_RBRC   ,JP_HASH   ,JP_CIRC   ,JP_YEN    ,_______   ,_______   ,
// +----------+----------+----------+----------+----------+----------+                                              +----------+----------+----------+----------+----------+----------+
    _______   ,KC_F9     ,KC_F10    ,KC_F11    ,KC_F12    ,JP_LABK   ,                                               JP_RABK   ,JP_SLSH   ,_______   ,_______   ,_______   ,_______   ,
// +----------+----------+----------+----------+------+---+------+---+------+----------+          +----------+------+---+------+----------+----------+----------+----------+----------+
                          _______   ,_______   ,       _______   ,_______   ,_______   ,           _______   ,_______   ,                                        _______
//                       +----------+----------+      +----------+----------+----------+          +----------+----------+                                       +----------+
  ),

  [_RSV1] = LAYOUT_right_ball(
// +----------+----------+----------+----------+----------+----------+                                              +----------+----------+----------+----------+----------+----------+
    _______   ,A(KC_F4)  ,C(KC_F4)  ,_______   ,_______   ,_______   ,                                               _______   ,_______   ,_______   ,_______   ,_______   ,_______   ,
// +----------+----------+----------+----------+----------+----------+                                              +----------+----------+----------+----------+----------+----------+
    _______   ,_______   ,_______   ,_______   ,_______   ,_______   ,                                               _______   ,_______   ,_______   ,_______   ,_______   ,_______   ,
// +----------+----------+----------+----------+----------+----------+                                              +----------+----------+----------+----------+----------+----------+
    _______   ,_______   ,_______   ,_______   ,_______   ,_______   ,                                               _______   ,_______   ,_______   ,_______   ,_______   ,_______   ,
// +----------+----------+----------+----------+------+---+------+---+------+----------+          +----------+------+---+------+----------+----------+----------+----------+----------+
                          _______   ,_______   ,       _______   ,_______   ,_______   ,           _______   ,_______   ,                                        _______
//                       +----------+----------+      +----------+----------+----------+          +----------+----------+                                       +----------+
  ),

  [_RSV2] = LAYOUT_right_ball(
// +----------+----------+----------+----------+----------+----------+                                              +----------+----------+----------+----------+----------+----------+
    _______   ,_______   ,_______   ,_______   ,_______   ,_______   ,                                               _______   ,_______   ,_______   ,_______   ,_______   ,_______   ,
// +----------+----------+----------+----------+----------+----------+                                              +----------+----------+----------+----------+----------+----------+
    _______   ,_______   ,_______   ,_______   ,_______   ,_______   ,                                               _______   ,_______   ,_______   ,_______   ,_______   ,_______   ,
// +----------+----------+----------+----------+----------+----------+                                              +----------+----------+----------+----------+----------+----------+
    _______   ,_______   ,_______   ,_______   ,_______   ,_______   ,                                               _______   ,_______   ,_______   ,_______   ,_______   ,_______   ,
// +----------+----------+----------+----------+------+---+------+---+------+----------+          +----------+------+---+------+----------+----------+----------+----------+----------+
                          _______   ,_______   ,       _______   ,_______   ,_______   ,           _______   ,_______   ,                                        _______
//                       +----------+----------+      +----------+----------+----------+          +----------+----------+                                       +----------+
  ),

  [_MACRO] = LAYOUT_right_ball(
// +----------+----------+----------+----------+----------+----------+                                              +----------+----------+----------+----------+----------+----------+
    _______   ,_______   ,_______   ,_______   ,_______   ,_______   ,                                               _______   ,_______   ,_______   ,_______   ,_______   ,_______   ,
// +----------+----------+----------+----------+----------+----------+                                              +----------+----------+----------+----------+----------+----------+
    _______   ,_______   ,_______   ,_______   ,_______   ,_______   ,                                               _______   ,_______   ,_______   ,_______   ,_______   ,_______   ,
// +----------+----------+----------+----------+----------+----------+                                              +----------+----------+----------+----------+----------+----------+
    _______   ,_______   ,_______   ,_______   ,_______   ,_______   ,                                               _______   ,_______   ,_______   ,_______   ,_______   ,_______   ,
// +----------+----------+----------+----------+------+---+------+---+------+----------+          +----------+------+---+------+----------+----------+----------+----------+----------+
                          _______   ,_______   ,       _______   ,_______   ,_______   ,           _______   ,_______   ,                                        _______
//                       +----------+----------+      +----------+----------+----------+          +----------+----------+                                       +----------+
  ),

  [_KB_CONF] = LAYOUT_right_ball(
// +----------+----------+----------+----------+----------+----------+                                              +----------+----------+----------+----------+----------+----------+
    RGB_TOG   ,AML_TO    ,AML_I50   ,AML_D50   ,_______   ,_______   ,                                               RGB_M_P   ,RGB_M_B   ,RGB_M_R   ,RGB_M_SW  ,RGB_M_SN  ,RGB_M_K   ,
// +----------+----------+----------+----------+----------+----------+                                              +----------+----------+----------+----------+----------+----------+
    RGB_MOD   ,RGB_HUI   ,RGB_SAI   ,RGB_VAI   ,_______   ,SCRL_DVI  ,                                               RGB_M_X   ,RGB_M_G   ,RGB_M_T   ,RGB_M_TW  ,_______   ,_______   ,
// +----------+----------+----------+----------+----------+----------+                                              +----------+----------+----------+----------+----------+----------+
    RGB_RMOD  ,RGB_HUD   ,RGB_SAD   ,RGB_VAD   ,_______   ,SCRL_DVD  ,                                               CPI_D1K   ,CPI_D100  ,CPI_I100  ,CPI_I1K   ,_______   ,KBC_SAVE  ,
// +----------+----------+----------+----------+------+---+------+---+------+----------+          +----------+------+---+------+----------+----------+----------+----------+----------+
                          QK_BOOT   ,KBC_RST   ,       _______   ,_______   ,_______   ,           _______   ,_______   ,                                        QK_BOOT
//                       +----------+----------+      +----------+----------+----------+          +----------+----------+                                       +----------+
  ),
};
// clang-format on


// ======================================================================
// Functions
// ======================================================================

void keyboard_post_init_user(void) {
    set_auto_mouse_enable(true);
}

layer_state_t layer_state_set_user(layer_state_t state) {
  keyball_set_scroll_mode(get_highest_layer(state) == _KB_CONF);
  return state;
}

#ifdef OLED_ENABLE
# include "lib/oledkit/oledkit.h"

void oledkit_render_info_user(void) {
  keyball_oled_render_keyinfo();
  keyball_oled_render_ballinfo();
  keyball_oled_render_layerinfo();
}
#endif
